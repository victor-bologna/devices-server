# Devices microservice API
Microservice API responsible for managing existent devices in database using REST API.

## Stack:
 - Java 21;
 - [Spring](https://spring.io/projects/spring-boot) Boot 3.5.x;
 - [Gradle](https://gradle.org/) 9.2.1;
 - [PostgreSQL](https://www.postgresql.org/) 16;
 - [Docker](https://www.docker.com/);
 - [Swagger](https://swagger.io/) Spring doc API.

## Architecture:
This project is made by 4 separated modules following [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html) 
principles to keep the all cores that maintain a fully working project isolated, independent and testable:

![UML Diagram.drawio.png](documentation/UML%20Diagram.drawio.png)

### Domain:
All the business rules regarding how devices should be manipulated are stored here, and what a Device object should have 
with what properties without any framework.<br>
Here we have what defines a Device, and our Device object is defined as:
- **Name**: Name of the device;
- **Brand**: Which brand this device is from;
- **State**: Shows the status of this device (available, in use or inactive);
- **Creation time**: When this Device was first created.<br>

We also have some business rules regarding the Device object:

- The device cannot be deleted if state is IN USE;
- Device name and brand cannot be updated if state is IN USE;
- Creation time cannot be changed after creation of a new device.

### Application:
Use cases and custom business exception handlers are stored here. 
All the business intentions should be executed here to generate an action.<br>
The usage of loggers here is recommended to keep track of possible errors, and tracing for observability that occurs during the process.<br>
This project consists in managing and manipulating devices from a database with some rules below:
- Create a device into database, if that name and brand exists, it cannot be duplicated;
- Delete a device by id from a database, if a Device is in use, it cannot be deleted;
- Find all devices from a database;
- Find all devices by brand or state from a database;
- Find a specific device by id from a database;
- Update a device fully/partially by id, if a device is in use previously and user wants to change brand or name, then a error occurs
saying that device is in use. 

### Infrastructure:
REST Controllers, adapters, gateways, providers and databases are here, we use Spring framework to make connections with outer services
such as databases, dependency injection, and entities without touching any business rules. <br>
Controllers in web layer uses CRUD (Create, Read, Update, Delete) operations to handle user requests and update devices.<br>
This project runs PostgreSQL to handle and keep hold of all data generated by the user. The usage of PostgreSQL is justified
to keep all the data Atomic, Consistent, Isolated and Durable (ACID) and if needed in the future to create relationship 
with other entities from other microservices. 

### MainApp:
Project main executable that allows everything to communicate and run the project. Here we have a integrated test

## How to run the project:
This project uses docker to isolate from user Operational System and create a whole structure capable of running only what's needed 
to make everything works without user needing to download anything externally than docker.

### Pre requisites:
Have Docker installed on user's machine.

### Running on docker:
In project's root directory in CMD, run: `docker compose up -d --build`, then check if docker is running with `docker compose ps`.<br>
**Note**: Keep in mind for API to run it needs to run the whole stack (API + PostgreSQL).

### Stopping the project on docker:
Run in project's root directory the following command: `docker compose down`
To stop and delete all the data generated: `docker compose down -v`

### Checking API information details:
Once the project is up and running,open:
- **Swagger UI**: http://localhost:8080/swagger-ui/index.html
- **OpenAPI JSON**: http://localhost:8080/v3/api-docs

To open Swagger to have access at all API endpoints and the contracts necessary to manipulate devices. <br>
To have access to all information in JSON format: `http://localhost:8080/v3/api-docs`.

## Next steps for future changes:
In order to evolve this project and keep it scalable, consistent and reliable, down is a list on what can be evolved:

- Add a secret manager (Like AWS) to not expose directly database password and URL and protect from users directly manipulating data;
- Add a gateway service to keep connection secure with routing;
- Add Spring's security at Controller's level with roles to prevent certain users from manipulating devices data;
- Add monitoring and telemetry such as datadog to analyze error rates and traceability;
- If the project has a high demand for GETs (brand, device or id), add a cache like Caffeine to prevent overloading database;
- Create a audit table at repository to keep track of changes made into the database.
